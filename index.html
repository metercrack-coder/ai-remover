<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Background Remover - Smart Detection</title>
<style>
/* ... all your existing CSS unchanged ... */
</style>
</head>
<body>
<div class="container">
    <h1>RETSAEHK</h1>
    <p class="subtitle">Automatic subject detection - removes ANY background</p>
    <div class="feature-tags">
        <span class="tag"> Complex Backgrounds</span>
        <span class="tag"> People Detection</span>
        <span class="tag"> Object Recognition</span>
        <span class="tag"> Deep Learning AI</span>
    </div>

    <div class="info-box">
        <strong> Smart AI Detection:</strong> Our AI automatically identifies the main subject (people, objects, animals) and removes everything else - works with complex patterns, outdoor scenes, crowded backgrounds, and more!
    </div>

    <div class="model-selector">
        <h3> Choose AI Model:</h3>
        <div class="model-options">
            <div class="model-option selected" onclick="selectModel('u2net')">
                <input type="radio" name="model" id="u2net" value="u2net" checked>
                <label for="u2net">
                    <div class="model-name">U2-Net (General)</div>
                    <div class="model-desc">Best for objects, people, animals</div>
                </label>
            </div>
            <div class="model-option" onclick="selectModel('u2netp')">
                <input type="radio" name="model" id="u2netp" value="u2netp">
                <label for="u2netp">
                    <div class="model-name">U2-Net+ (Fast)</div>
                    <div class="model-desc">Faster processing, good quality</div>
                </label>
            </div>
            <div class="model-option" onclick="selectModel('u2net_human_seg')">
                <input type="radio" name="model" id="u2net_human_seg" value="u2net_human_seg">
                <label for="u2net_human_seg">
                    <div class="model-name">Human Focus</div>
                    <div class="model-desc">Optimized for people photos</div>
                </label>
            </div>
        </div>
    </div>

    <div class="upload-area" id="uploadArea">
        <div class="upload-icon">ðŸ“¸</div>
        <div class="upload-text">Click to upload or drag & drop</div>
        <div class="upload-subtext">Supports: JPG, PNG, WEBP - Any background complexity</div>
        <input type="file" id="fileInput" accept="image/*">
    </div>

    <div class="error" id="errorMsg"></div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>AI is analyzing and removing background... This may take a few seconds</p>
    </div>

    <div class="preview-container" id="previewContainer">
        <div class="preview-box">
            <h3>Original Image</h3>
            <div class="image-wrapper">
                <img id="originalImg" alt="Original">
            </div>
        </div>
        <div class="preview-box">
            <h3>Background Removed </h3>
            <div class="image-wrapper">
                <img id="resultImg" alt="Result">
            </div>
        </div>
    </div>

    <div class="controls" id="controls" style="display: none;">
        <button class="btn" onclick="downloadImage()">ðŸ’¾ Download Result</button>
        <button class="btn" onclick="reset()">ðŸ”„ Upload New Image</button>
    </div>
</div>

<script>
const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');
const loading = document.getElementById('loading');
const previewContainer = document.getElementById('previewContainer');
const originalImg = document.getElementById('originalImg');
const resultImg = document.getElementById('resultImg');
const controls = document.getElementById('controls');
const errorMsg = document.getElementById('errorMsg');

let resultImageData = null;
let selectedModel = 'u2net';

function selectModel(model) {
    selectedModel = model;
    document.querySelectorAll('.model-option').forEach(opt => {
        opt.classList.remove('selected');
    });
    event.currentTarget.classList.add('selected');
    document.getElementById(model).checked = true;
}

// Click to upload
uploadArea.addEventListener('click', () => fileInput.click());

// Drag and drop
uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.classList.add('dragover');
});
uploadArea.addEventListener('dragleave', () => {
    uploadArea.classList.remove('dragover');
});
uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
    const file = e.dataTransfer.files[0];
    if (file && file.type.startsWith('image/')) processImage(file);
});
fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) processImage(file);
});

async function processImage(file) {
    const reader = new FileReader();
    reader.onload = (e) => { originalImg.src = e.target.result; };
    reader.readAsDataURL(file);

    loading.classList.add('active');
    errorMsg.classList.remove('active');
    previewContainer.classList.remove('active');
    controls.style.display = 'none';

    await removeBackground(file);
}

async function removeBackground(file) {
    try {
        const formData = new FormData();
        formData.append('image', file);
        formData.append('model', selectedModel);

        // PATCHED: Use your Render URL here
        const response = await fetch('https://ai-remover.onrender.com', {
            method: 'POST',
            body: formData
        });

        if (!response.ok) throw new Error('Failed to remove background');
        const data = await response.json();

        if (data.success) {
            resultImageData = data.image;
            resultImg.src = data.image;

            loading.classList.remove('active');
            previewContainer.classList.add('active');
            controls.style.display = 'block';
        } else {
            throw new Error(data.error || 'Unknown error');
        }
    } catch (error) {
        loading.classList.remove('active');
        showError('âš  Error: ' + error.message + '\n\nMake sure your backend is running and accessible.');
    }
}

function showError(message) {
    errorMsg.textContent = message;
    errorMsg.classList.add('active');
}

function downloadImage() {
    if (resultImageData) {
        const link = document.createElement('a');
        link.href = resultImageData;
        link.download = 'background_removed_ai.png';
        link.click();
    }
}

function reset() {
    fileInput.value = '';
    previewContainer.classList.remove('active');
    controls.style.display = 'none';
    errorMsg.classList.remove('active');
    resultImageData = null;
}
</script>
</body>
</html>
